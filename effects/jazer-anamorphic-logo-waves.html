<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JaZeR Anamorphic Logo Waves</title>
  <style>
    :root {
      color-scheme: dark;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, sans-serif;
      background: linear-gradient(180deg, #040513 0%, #010108 70%);
      color: #d5d9ff;
      overflow: hidden;
      min-height: 100vh;
    }

    canvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      display: block;
    }

    .label {
      position: fixed;
      right: 2rem;
      bottom: 2rem;
      text-transform: uppercase;
      letter-spacing: 0.25em;
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.5);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <canvas id="effect"></canvas>
  <div class="label">Anamorphic Logo Waves</div>
  <script type="module">
    import { mouse, noise2D, smoothstep, ColorPalettes } from '../lib/jazer-background-engine.js';

    const canvas = document.getElementById('effect');
    const ctx = canvas.getContext('2d');
    const palette = ColorPalettes.vapor || ColorPalettes.cyberpunk || ColorPalettes.jazer;

    const ROWS = 58;
    const COLS = 160;
    const CREST_COUNT = 90;
    const MASK_WIDTH = 640;
    const MASK_HEIGHT = 160;

    const maskCanvas = document.createElement('canvas');
    maskCanvas.width = MASK_WIDTH;
    maskCanvas.height = MASK_HEIGHT;
    const maskCtx = maskCanvas.getContext('2d');
    const logoProfile = new Float32Array(MASK_WIDTH);

    const crestParticles = [];

    let width = 0;
    let height = 0;
    let lastTime = 0;
    let time = 0;

    class CrestParticle {
      constructor() {
        this.reset();
      }

      reset() {
        this.depth = 0.05 + Math.random() * 0.35;
        this.column = Math.random();
        this.life = 0.8 + Math.random() * 1.4;
        this.elapsed = Math.random() * this.life;
        this.color = palette[Math.floor(Math.random() * palette.length)] || '#00f5ff';
        this.size = 1.5 + Math.random() * 1.5;
      }

      tick(dt) {
        this.elapsed += dt;
        this.column = (this.column + dt * 0.05) % 1;
        if (this.elapsed > this.life) {
          this.reset();
        }
      }

      draw() {
        const h = computeHeight(this.column, this.depth);
        const pos = projectPoint(this.column, this.depth, h);
        const fade = 1 - this.elapsed / this.life;
        ctx.globalAlpha = fade;
        ctx.fillStyle = ``;
        ctx.shadowColor = this.color;
        ctx.shadowBlur = 12;
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    function rebuildLogoMask() {
      maskCtx.clearRect(0, 0, MASK_WIDTH, MASK_HEIGHT);
      maskCtx.fillStyle = '#000';
      maskCtx.fillRect(0, 0, MASK_WIDTH, MASK_HEIGHT);
      maskCtx.fillStyle = '#fff';
      maskCtx.font = `${MASK_HEIGHT * 0.75}px 'Inter', sans-serif`;
      maskCtx.textAlign = 'center';
      maskCtx.textBaseline = 'middle';
      maskCtx.fillText('JAZER', MASK_WIDTH / 2, MASK_HEIGHT * 0.55);
      const data = maskCtx.getImageData(0, 0, MASK_WIDTH, MASK_HEIGHT).data;
      for (let x = 0; x < MASK_WIDTH; x++) {
        let total = 0;
        for (let y = 0; y < MASK_HEIGHT; y++) {
          total += data[(y * MASK_WIDTH + x) * 4 + 3];
        }
        logoProfile[x] = total / (MASK_HEIGHT * 255);
      }
    }

    function sampleMask(t) {
      const index = Math.max(0, Math.min(MASK_WIDTH - 1, Math.floor(t * (MASK_WIDTH - 1))));
      return logoProfile[index] || 0;
    }

    function computeHeight(column, depth) {
      const wave = Math.sin(time * 1.4 + depth * 12 + column * 18) * (30 + depth * 55);
      const ripple = noise2D(column * 5, time * 0.5 + depth * 3) * 20;
      const reveal = 1 - smoothstep(0.05, 0.25, depth);
      const imprint = sampleMask(column) * reveal * 140;
      return wave + ripple - imprint;
    }

    function projectPoint(column, depth, heightValue) {
      const depthScale = 1 - depth * 0.75;
      const spread = width * (0.85 + depth * 0.25);
      const baseY = height * 0.78 - depth * height * 0.35;
      const x = width / 2 + (column - 0.5) * spread + mouse.centeredX * depth * 220;
      const y = baseY - heightValue * depthScale * 0.45 + mouse.centeredY * depth * -120;
      return { x, y };
    }

    function hexToRgba(hex, alpha) {
      const value = hex.replace('#', '');
      const bigint = parseInt(value, 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    function resize() {
      const dpr = Math.min(2, window.devicePixelRatio || 1);
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width * dpr;
      canvas.height = height * dpr;
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      rebuildLogoMask();
    }

    function setup() {
      rebuildLogoMask();
      for (let i = 0; i < CREST_COUNT; i++) {
        crestParticles.push(new CrestParticle());
      }
      resize();
      requestAnimationFrame(render);
    }

    window.addEventListener('resize', resize);

    function render(now) {
      const dt = (now - lastTime) / 1000 || 0;
      lastTime = now;
      time += dt;
      mouse.update();

      ctx.clearRect(0, 0, width, height);
      drawBackground();
      drawGhostText();
      drawGrid();
      drawCrests(dt);
      drawScanlines();

      requestAnimationFrame(render);
    }

    function drawBackground() {
      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, '#050516');
      gradient.addColorStop(0.6, '#01000a');
      gradient.addColorStop(1, '#000000');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, width, height);
    }

    function drawGhostText() {
      ctx.save();
      ctx.translate(width / 2, height * 0.38);
      ctx.transform(1, -0.35, 0, 1, 0, 0);
      ctx.font = `${Math.min(width * 0.35, 360)}px 'Inter', sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      const ghostGrad = ctx.createLinearGradient(-width * 0.4, 0, width * 0.4, 0);
      ghostGrad.addColorStop(0, 'rgba(0, 245, 255, 0.08)');
      ghostGrad.addColorStop(1, 'rgba(255, 42, 255, 0.08)');
      ctx.fillStyle = ghostGrad;
      ctx.globalCompositeOperation = 'screen';
      ctx.fillText('JAZER', 0, 0);
      ctx.restore();
    }

    function drawGrid() {
      ctx.save();
      ctx.lineWidth = 1;

      for (let row = 0; row < ROWS; row++) {
        const depth = row / (ROWS - 1);
        ctx.beginPath();
        for (let col = 0; col <= COLS; col++) {
          const column = col / COLS;
          const h = computeHeight(column, depth);
          const pos = projectPoint(column, depth, h);
          if (col === 0) {
            ctx.moveTo(pos.x, pos.y);
          } else {
            ctx.lineTo(pos.x, pos.y);
          }
        }
        const alpha = 0.15 + (1 - depth) * 0.35;
        const color = palette[row % palette.length] || '#00f5ff';
        ctx.strokeStyle = hexToRgba(color, alpha);
        ctx.stroke();
      }

      for (let col = 0; col <= COLS; col += 8) {
        ctx.beginPath();
        for (let row = 0; row < ROWS; row++) {
          const depth = row / (ROWS - 1);
          const column = col / COLS;
          const h = computeHeight(column, depth);
          const pos = projectPoint(column, depth, h);
          if (row === 0) {
            ctx.moveTo(pos.x, pos.y);
          } else {
            ctx.lineTo(pos.x, pos.y);
          }
        }
        ctx.strokeStyle = 'rgba(255,255,255,0.08)';
        ctx.stroke();
      }

      ctx.restore();
    }

    function drawCrests(dt) {
      crestParticles.forEach(particle => {
        particle.tick(dt);
        particle.draw();
      });
    }

    function drawScanlines() {
      ctx.save();
      ctx.globalAlpha = 0.1;
      ctx.fillStyle = '#05050d';
      for (let y = 0; y < height; y += 4) {
        ctx.fillRect(0, y, width, 1);
      }
      ctx.restore();
    }

    setup();
  </script>
</body>
</html>

